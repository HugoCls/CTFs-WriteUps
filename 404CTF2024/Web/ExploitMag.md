# Exploit mag
## Enoncé
> Alors que la compétition bat son plein, votre entraîneur vient à votre rencontre :
>> Hey ! Je ne sais pas si tu as vu, mais il parait qu'un magazine en ligne a publié des trucs "intéressants" sur la compétition. C'est un ami à moi qui m'a envoyé le lien.
> En allant jeter un œil, rien ne semble différencier ce magazine d'un autre site sportif aux titres racoleurs... Mais l'un des articles attire votre attention. Ce serait bien de pouvoir y accéder, au moins pour savoir ce qu'ont appris les athlètes qui l'ont lu. Mais pas question de payer, il doit bien exister un autre moyen...

Auteur: **@Artamis**
 
Connexion: `https://exploit-mag.challenges.404ctf.fr`

## Analyse

On arrive sur un site de presse, où les articles sont disponibles entièrement uniquement au prix d'un abonnement.

Il y a deux liens qui pourraient nous intéresser: `https://exploit-mag.challenges.404ctf.fr/news/` et `https://exploit-mag.challenges.404ctf.fr/pricing/`.

Comme il n'y a pas création de compte, ou de cookies relié à notre connexion, il est intéressant de se demander comment le site effectue la vérification sur notre légitimité à voir ou non les articles. 

Il va peut être nous falloir implémenter un cookie à un moment ou à un autre.

### `/pricing`

<p align="center">
    <img src="../image/404CTFWeb3.png" alt="img1" style="width:40%;">
</p>

Le seul moyen d'accéder aux articles serait d'être premium, mais en observant le code source de la page, on apprend que le bouton "C'est parti !" n'effectue aucune autre action que de nous rediriger vers la page `/news`. Nous avons aucun indice sur ce potentiel cookie de légitimité.

### `/news`

En arrivant sur un article quelconque on tombe sur cette barrière de paiement:

<p align="center">
    <img src="../image/404CTFWeb4.png" alt="img1" style="width:40%;">
</p>

Seulement, lorsque l'on appuie sur le captcha résultat, rien ne se passe, il tourne en boucle.

Après analyse de son code source, les injections XSS sont possibles par la variable onclick, seulement elles ne mènent à rien.

Avec un peu plus d'observation on apprend par l'id d'un élément que ce genre de barrières s'appellent des paywalls.

Avec un peu de documentation sur internet, on apprend que certains sites laissent passer les bots crawlers de google pour obtenir un meilleur référencement, et il est possible d'usurper leur identité en utilisant leur User-Agent associé.

## Exploitation

L'article nous intéressant le plus est évidemment celui-ci `/dataleak-404-ctf`, mais nous aurions pu tous les faire;

On reproduit la requête d'obtention de l'article en changeant l'User-Agent par celui d'un Google Bot:
```http
GET /news/dataleak-404-ctf/ HTTP/1.1
Host: exploit-mag.challenges.404ctf.fr
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "Windows"
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Accept-Language: fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7
Priority: u=0, i
Connection: close
```

Et on obtient directement l'article complet, et le flag 

Flag: **404CTF{p4yw4lL_bYpa55_1s_dAnG3r0us}**